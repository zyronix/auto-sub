(function(f){var c={popupDiv:"pcMenu",separator:"separator",hover:"hover",disabled:"disabled"},g={menu:null,mouseButton:"right",isMenu:true,minWidth:120,maxWidth:0,delay:500,keyboard:true,hoverIntent:true,onSelect:function(h){},onLoad:function(){},onShow:function(){},onHide:function(){}},e=[],a={init:function(h){h=f.extend({},g,h);if(!h.menu){return false}var i;if((typeof(h.menu)==="object")&&(h.menu.constructor.toString().match(/array/i)!==null||h.menu.length)){i=f("<div/>").append(b(h.menu));f("body").append(i);i.data("pcDynamic",true)}else{i=f(document.getElementById(h.menu));i.data("pcDynamic",false);i.data("pcOriginal",i.clone())}return this.each(function(){var k=f(this),j;if(!k.data("pcMenu")){j="pcContext-"+(new Date().getTime());k.data("pcEventNamespace",j).data("pcOptions",h).data("pcMenu",i).data("pcEnable",true);i.data("isMenu",h.isMenu);if(!i.data("pcOwners")){i.data("pcOwners",[])}i.data("pcOwners").push(k);e.push(i);if(h.isMenu){a.refresh.call(k)}else{i.hide();i.css({position:"absolute","z-index":99999})}k.bind((((h.mouseButton==="right")?"contextmenu":"click")+"."+j),function(l){if(!k.data("pcEnable")){return true}a.show.apply(k,[l.pageX,l.pageY,h.showAnimation]);if(h.isMenu&&h.keyboard){f(window).bind("keydown."+j,function(n){var m;switch(event.keyCode){case 27:f(document).trigger("click."+j);break;case 40:if(i.find("li."+c.hover).length===0){i.find("li:not(.disabled):first").addClass(c.hover)}else{m=i.find("li."+c.hover+":last");m.parent().find("li."+c.hover).removeClass(c.hover).nextAll("li:not(.disabled)").eq(0).addClass(c.hover);if(m.parent().find("li."+c.hover).length===0){m.parent().find("li:not(.disabled):first").addClass(c.hover)}}return false;case 38:if(i.find("li."+c.hover).length===0){i.find("li:not(.disabled):first").nextAll().eq(-1).addClass(c.hover)}else{m=i.find("li."+c.hover+":last");m.parent().find("li."+c.hover).removeClass(c.hover).prevAll("LI:not(.disabled)").eq(0).addClass(c.hover);if(m.parent().find("li."+c.hover).length===0){m.parent().find("li:first").nextAll().eq(-1).addClass(c.hover)}}return false;case 39:if(i.find("li."+c.hover+" ul").length>0){i.find("li."+c.hover+":last").find("ul:first").show().offset(d({top:i.find("li."+c.hover+":last").offset().top},i.find("li."+c.hover+":last").find("ul:first")));i.find("li."+c.hover+":last ul:first li:not(.disabled):first").addClass(c.hover)}return false;case 37:if(!i.find("li."+c.hover+":last").parent().parent().hasClass(c.popupDiv)){i.find("li."+c.hover+":last").removeClass(c.hover).parent().hide()}return false}return true})}else{if(h.keyboard){f(window).bind("keydown."+j,function(m){if(event.keyCode===27){f(document).trigger("click."+j)}})}}f("li",i).each(function(){f(this).click(function(){if(!f(this).hasClass(c.disabled)){h.onSelect.call(this,{id:f(this).attr("id"),action:f("a:first",this).attr("href").substr(1)})}})});f(document).bind("click."+j,function(m){f(window).unbind("keydown."+j);f(document).unbind("click."+j);f("li",i).unbind("click");a.hide.call()});h.onShow.call(this);return false})}h.onLoad.call(this)})},refresh:function(h){var i;return this.each(function(){var m=f(this),l=m.data("pcMenu"),j,k;if(m.data("pcMenu").data("isMenu")){i=f.extend(m.data("pcOptions"),h);if(i.hoverIntent&&!f.fn.hoverIntent){i.hoverIntent=false}l.removeClass(c.popupDiv);f("li",l).removeClass(c.hover);f("span",l).remove();l.addClass(c.popupDiv);k=f("<div/>").addClass(c.popupDiv).appendTo("body");f("ul",l).each(function(){k.html("");j=0;k.html(f(this).html());j=k.width()+16;if(j<i.minWidth){j=i.minWidth}if(j>i.maxWidth&&i.maxWidth>0){j=i.maxWidth}f(this).width(j);f(this).children("li").children("ul").css("left",j)});k.remove();f("li:has(ul)",l).each(function(){if(!f(this).hasClass(c.disabled)){f("a:first",this).append(f("<span/>"));if(i.hoverIntent){f(this).hoverIntent({over:function(){f("ul:first",this).show().offset(d({top:f(this).offset().top},f("ul:first",this)))},out:function(){f("ul:first",this).hide()},timeout:i.delay})}else{f(this).hover(function(){f("ul:first",this).show().offset(d({top:f(this).offset().top},f(this).find("ul:first")))},function(){f("ul:first",this).hide()})}}});f("li",l).each(function(){f(this).click(function(){if(f("ul",this).length<1){f("li",l).unbind("click");l.hide()}return false});f(this).hover(function(){f(this).parent().find("li."+c.hover).removeClass(c.hover);f(this).addClass(c.hover)},function(){f(this).removeClass(c.hover)})})}})},restore:function(){return this.each(function(){var i=f(this),h=i.data("pcMenu");i.unbind("."+i.data("pcEventNamespace"));f(window).unbind("keydown."+i.data("pcEventNamespace"));f(document).unbind("click."+i.data("pcEventNamespace"));f.each(h.data("pcOwners"),function(j){if(i[0]===this){h.data("pcOwners").splice(j,1)}});if(h.data("pcOwners").length<1){f.each(e,function(j){if(h[0]===this){e.splice(j,1)}});if(h.data("pcDynamic")){h.remove()}else{h.removeClass(c.popupDiv);h.replaceWith(h.data("pcOriginal"))}}i.removeData("pcEventNamespace");i.removeData("pcMenu");i.removeData("pcOptions");i.removeData("pcEnable")})},show:function(h,j){if(!h||!j){f.error("The position for the menu has not been specified");return false}var i=f(this).first().data("pcMenu");a.hide.apply(this);i.show();i.data("pcMenu",f(this));i.offset(d({top:j,left:h},i,true));return this},hide:function(){f.each(e,function(){f("."+c.hover,this).removeClass(c.hover);f("ul:first ul",this).hide();if(f(this).data("pcMenu")){f(this).data("pcMenu").data("pcOptions").onHide.call(f(this).data("pcMenu"));f(this).removeData("pcMenu")}f(this).hide()});return this},disable:function(i){if(i){var h=f(this).data("pcMenu");if(i.charAt(0)==="#"){f("li"+i.replace(/ /g,"_"),h).addClass(c.disabled)}else{f('a[href="'+i+'"]',h).parent().addClass(c.disabled)}}else{f(this).data("pcEnable",false)}return this},enable:function(i){if(i){var h=f(this).data("pcMenu");if(i.charAt(0)==="#"){f("li"+i.replace(/ /g,"_"),h).removeClass(c.disabled)}else{f('a[href="'+i+'"]',h).parent().removeClass(c.disabled)}}else{f(this).data("pcEnable",true);f("li",this).each(function(){f(this).removeClass(c.disabled)})}return this}},d=function(h,j,i){if(h.top){if((h.top+j.height()-f(window).scrollTop())>f(window).height()){if(i){h.top=h.top-j.height()}else{h.top=f(window).height()+f(window).scrollTop()-j.height()}}if(h.top<f(window).scrollTop()){h.top=f(window).scrollTop()}}if(h.left){if((h.left+j.width()-f(window).scrollLeft()>f(window).width())){h.left=f(window).width()-j.width()+f(window).scrollLeft()}if(h.left<f(window).scrollLeft()){h.left=f(window).scrollLeft()}}return h},b=function(j){var i=f("<ul/>"),l,k,h;if(j){for(l in j){k=j[l];h=f("<li/>").attr("id",k.id.replace(/ /g,"_")).append(f("<a/>").attr("href",k.action?("#"+k.action):"#").text(k.text));if(k.image){h.prepend(f("<img/>").attr("src",k.image))}if(k.separator){h.addClass(c.separator)}i.append(h);if(k.children){h.append(b(k.children))}}}return i};f.fn.powerContext=function(h){if(a[h]){return a[h].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof h==="object"||!h){return a.init.apply(this,arguments)}else{f.error("Method "+h+" does not exist on jQuery.powerContext");return this}}}})(jQuery);